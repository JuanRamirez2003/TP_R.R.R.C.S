<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirmación de Pedido</title>
</head>
<body>
<h2>Confirmación de Pedido</h2>
<p id="mensaje">Procesando...</p>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl = "https://ldgrlfnmuvvaqsezjsvj.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxkZ3JsZm5tdXZ2YXFzZXpqc3ZqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5MzEwNDMsImV4cCI6MjA3NDUwNzA0M30.NrUTqCLkzMWUGqn2XIAsCY8H90vgHpuxhMT2zIVt3Zo";
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

const params = new URLSearchParams(window.location.search);
const pedidoId = params.get("id");
const mensaje = document.getElementById("mensaje");

if (!pedidoId) {
  mensaje.textContent = "No se encontró el pedido.";
} else {
  (async () => {
    try {
      const { data, error } = await supabaseClient
        .from('orden_compra_mp')
        .update({ estado: 'Recibido' })
        .eq('id', pedidoId);
      if (error) throw error;
      mensaje.textContent = "¡Pedido confirmado como recibido!";
    } catch (err) {
      console.error(err);
      mensaje.textContent = "Error al confirmar el pedido. Intente nuevamente.";
    }
  })();
}
</script>
</body>
</html>